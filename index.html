<!DOCTYPE html>
    <html>
    <head>
        <style type="text/css">
            body {
                overflow:hidden;
                width: 100%;
                height: 100%;
                padding: 0;
                margin: 0;
                /*background-color: rgba(0, 0, 0, 0.5);*/
                font-family: 'Roboto', sans-serif;
                background: #c6c8c7; /* Old browsers */
                background: -moz-linear-gradient(top,  #c6c8c7 0%, #d0d4d5 34%, #ececec 67%, #fefefe 100%); /* FF3.6+ */
                background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#c6c8c7), color-stop(34%,#d0d4d5), color-stop(67%,#ececec), color-stop(100%,#fefefe)); /* Chrome,Safari4+ */
                background: -webkit-linear-gradient(top,  #c6c8c7 0%,#d0d4d5 34%,#ececec 67%,#fefefe 100%); /* Chrome10+,Safari5.1+ */
                background: -o-linear-gradient(top,  #c6c8c7 0%,#d0d4d5 34%,#ececec 67%,#fefefe 100%); /* Opera 11.10+ */
                background: -ms-linear-gradient(top,  #c6c8c7 0%,#d0d4d5 34%,#ececec 67%,#fefefe 100%); /* IE10+ */
                background: linear-gradient(to bottom,  #c6c8c7 0%,#d0d4d5 34%,#ececec 67%,#fefefe 100%); /* W3C */
                filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#c6c8c7', endColorstr='#fefefe',GradientType=0 ); /* IE6-9 */

            }
            .header { padding: 10px 60px; }
            .appName {
                margin: 0;
                padding: 0;
                font-size: 30px;
                font-weight: 100;
                color: #efefef;
                text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
                width: 340px;
                display: inline-block;
            }
            .appName > span {
                font-weight: 300;
            }
            .appName > img {
                vertical-align: middle;
                margin-right: 20px;
                width: 56px;
            }
            .gridName {
                display: inline-block;
                margin: 0;
                padding: 0;
                text-align: center;
                text-transform: uppercase;
                color: #efefef;
                text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
                margin-left: 200px;
                font-size: 23px;
            }
            .gridsContainer {
                padding: 30px 0;
                text-align: center;
            }
            .paper {
                box-shadow: 0 3px 10px rgba(0, 0, 0, 0.16);
                border-radius: 2px;
            }
            .paper-depth4 {
                box-shadow: 0 16px 28px 0 rgba(0, 0, 0, 0.22), 0 25px 55px 0 rgba(0, 0, 0, 0.21);
                border-radius: 2px;
            }

            .gridItemsRow { display: table; }
            .gridItemContainer {
                display: table-cell;
                min-width: 330px;
                max-width: 527px;
                padding: 10px 15px;
                box-sizing: border-box;
            }
            .gridItem {
                width: 100%;
                text-align: left;
            }
            .gridItem_graph {
                background-color: #f0f0f0;
                background-repeat: no-repeat;
                background-size: cover;
                height: 228px;
                border-top: 2px solid rgba(255, 255, 255, 0.5);
                box-sizing: border-box;
                border-top-left-radius: 3px;
                border-top-right-radius: 3px;
            }
            .gridItemInfos {
                background: #f0f0f0;
                padding: 15px 20px;
                border-top: 1px solid rgba(0, 0, 0, 0.1);
                border-bottom-left-radius: 3px;
                border-bottom-right-radius: 3px;
            }
            .gridItem_pluginName {
                font-size: 18px;
                color: #555;
            }
            .gridItem_serverName { color: #999; }
            #gridsContainer { padding: 20px 40px 0 40px; }
            .fullscreen {
                position: fixed;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                background-color: rgba(0, 0, 0, 0.4);
            }
            .fullscreenCard {
                width: 497px;
                margin: auto;
                position: relative;
                top: 50%;
                margin-top: -100px;
                background-color: #fff;
            }
            .fullscreenCard > img {
                border-bottom-left-radius: 3px;
                border-bottom-right-radius: 3px;
            }
            .card-icon {
                width: 40px;
                height: 40px;
                border-radius: 20px;
                background-color: #999;
                float: left;
                margin-right: 10px;
            }
            .card-icon > img {
                width: 35px;
                height: 35px;
                margin-top: 2px;
                margin-left: 3px;
            }
            .card-header { padding: 18px 16px; }
            .card-pluginName {
                font-size: 18px;
                color: #555;
            }
            .card-serverName { color: #999; }

            .preloader {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #000000; /* Old browsers */
                background: -moz-linear-gradient(top,  #000000 0%, #313942 100%); /* FF3.6+ */
                background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#000000), color-stop(100%,#313942)); /* Chrome,Safari4+ */
                background: -webkit-linear-gradient(top,  #000000 0%,#313942 100%); /* Chrome10+,Safari5.1+ */
                background: -o-linear-gradient(top,  #000000 0%,#313942 100%); /* Opera 11.10+ */
                background: -ms-linear-gradient(top,  #000000 0%,#313942 100%); /* IE10+ */
                background: linear-gradient(to bottom,  #000000 0%,#313942 100%); /* W3C */
                filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#000000', endColorstr='#313942',GradientType=0 ); /* IE6-9 */
                color: #fff;
                font-weight: 100;
                font-size: 60px;
            }
            .preloader div {
                position: absolute;
                width: 100%;
                text-align: center;
                top: 50%;
                margin-top: -100px;
            }
            .preloader div img {
                vertical-align: middle;
                margin-bottom: 10px;
                margin-right: 20px;
            }
            .preloader span {
                font-weight: 300;
            }
            #loaderImage {
                position: fixed;
                z-index: 1;
                bottom: 50px;
                left: 50%;
                margin-left: -32px;
            }
        </style>
        <title>Munin for Android</title>
        <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100' rel='stylesheet' type='text/css'>
    </head>
    <body>
    <div id="loaderImage"></div>
    <div id="preloader" class="preloader">
        <div><img src="img/app_icon.png" /> <span>Munin</span> for Android</div>
    </div>
        <div id="fullscreen" class="fullscreen" style="display:none;">
            <div class="paper-depth4 fullscreenCard">
                <div class="card-header">
                    <div class="card-icon"><img src="img/ic_graph.png" /></div>
                    <div class="card-pluginName"></div>
                    <div class="card-serverName"></div>
                </div>
                <img id="card-graph" />
            </div>
        </div>
        <div class="header">
            <div class="appName"><img src="img/app_icon.png" /><span>Munin</span> for Android</div>
            <div id="gridName" class="gridName"></div>
        </div>
        <div id="gridsContainer" class="gridsContainer"></div>

        <script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>
        <script type="text/javascript" src="//code.jquery.com/jquery-2.1.3.min.js"></script>
        <script type="text/javascript" src="js/loader.js"></script>
        <script type="text/javascript">
            // Set CHROMECAST to false when debugging on a web browser
            var CHROMECAST = false;
            var DEBUG = true;

            window.onload = function() {
                if (CHROMECAST) {
                    cast.receiver.logger.setLevelValue(0);
                    window.castReceiverManager = cast.receiver.CastReceiverManager.getInstance();
                    log('Starting Receiver Manager');

                    // handler for the 'ready' event
                    castReceiverManager.onReady = function(event) {
                        log('Received Ready event: ' + JSON.stringify(event.data));
                        window.castReceiverManager.setApplicationState("Application status is ready...");
                        hideLoading();
                    };

                    // handler for 'senderconnected' event
                    castReceiverManager.onSenderConnected = function(event) {
                        log('Received Sender Connected event: ' + event.data);
                        log(window.castReceiverManager.getSender(event.data).userAgent);
                    };

                    // handler for 'senderdisconnected' event
                    castReceiverManager.onSenderDisconnected = function(event) {
                        log('Received Sender Disconnected event: ' + event.data);
                        if (window.castReceiverManager.getSenders().length == 0) {
                            window.close();
                        }
                    };

                    // handler for 'systemvolumechanged' event
                    /*castReceiverManager.onSystemVolumeChanged = function(event) {
                        log('Received System Volume Changed event: ' + event.data['level'] + ' ' + event.data['muted']);
                    };*/

                    // create a CastMessageBus to handle messages for a custom namespace
                    window.messageBus = window.castReceiverManager.getCastMessageBus(
                            'urn:x-cast:com.chteuchteu.munin');

                    // handler for the CastMessageBus message event
                    window.messageBus.onMessage = function(event) {
                        log('Message [' + event.senderId + ']: ' + event.data);
                        // display the message from the sender
                        receiveMessage(event.data);
                        // inform all senders on the CastMessageBus of the incoming message event
                        // sender message listener will be invoked
                        window.messageBus.send(event.senderId, event.data);
                    };

                    // initialize the CastReceiverManager with an application status message
                    window.castReceiverManager.start({statusText: "Application is starting"});
                    log('Receiver Manager started');
                } else {
                    hideLoading();
                    initGrid('Grid test');
                    inflateGridItems([
                        {'graphUrl': 'http://demo.munin-monitoring.org/munin-cgi/munin-cgi-graph/munin-monitoring.org/demo.munin-monitoring.org/multicpu1sec-day.png',
                            'pluginName': 'multicpu1sec', 'serverName': 'demo.munin-monitoring.org', 'x': '0', 'y': '0'},
                        {'graphUrl': 'http://demo.munin-monitoring.org/munin-cgi/munin-cgi-graph/munin-monitoring.org/demo.munin-monitoring.org/traffic-day.png',
                            'pluginName': 'Traffic per interface', 'serverName': 'demo.munin-monitoring.org', 'x': '1', 'y': '0'},
                        {'graphUrl': 'http://demo.munin-monitoring.org/munin-cgi/munin-cgi-graph/munin-monitoring.org/demo.munin-monitoring.org/cpu-day.png',
                            'pluginName': 'CPU usage', 'serverName': 'demo.munin-monitoring.org', 'x': '2', 'y': '0'},
                        {'graphUrl': 'http://demo.munin-monitoring.org/munin-cgi/munin-cgi-graph/munin-monitoring.org/demo.munin-monitoring.org/multicpu1sec-day.png',
                            'pluginName': 'multicpu1sec', 'serverName': 'demo.munin-monitoring.org', 'x': '0', 'y': '1'},
                        {'graphUrl': 'http://demo.munin-monitoring.org/munin-cgi/munin-cgi-graph/munin-monitoring.org/demo.munin-monitoring.org/multicpu1sec-day.png',
                            'pluginName': 'multicpu1sec', 'serverName': 'demo.munin-monitoring.org', 'x': '2', 'y': '1'},
                        {'graphUrl': 'http://demo.munin-monitoring.org/munin-cgi/munin-cgi-graph/munin-monitoring.org/demo.munin-monitoring.org/multicpu1sec-day.png',
                            'pluginName': 'multicpu1sec', 'serverName': 'demo.munin-monitoring.org', 'x': '3', 'y': '1'},
                        {'graphUrl': 'http://demo.munin-monitoring.org/munin-cgi/munin-cgi-graph/munin-monitoring.org/demo.munin-monitoring.org/multicpu1sec-day.png',
                            'pluginName': 'multicpu1sec', 'serverName': 'demo.munin-monitoring.org', 'x': '0', 'y': '2'}
                    ]);
                }
            };

            function hideLoading() {
                stopAnimation();
                $('#loaderImage').hide();
                $('#preloader').fadeOut();
            }

            function initGrid(gridName) {
                $('#gridName').text(gridName);
            }

            function receiveMessage(text) {
                var jsonMessage = JSON.parse(text);
                var action = jsonMessage['action'];

                switch (action) {
                    case 'inflate_grid':
                        initGrid(jsonMessage["gridName"]);
                        inflateGridItems(jsonMessage['gridItems']);
                        break;
                    default: break;
                }
            }

            function inflateGridItems(gridItems) {
                var maxRow = getMaxRows(gridItems);

                for (var y=0; y<=maxRow; y++) {
                    var rowItems = getRowItems(gridItems, y);

                    var rowHtml = '';
                    for (var i=0; i<rowItems.length; i++)
                        rowHtml += getGridItemHtml(rowItems[i]);

                    $('#gridsContainer').append('<div class="gridItemsRow">' + rowHtml + '</div>');
                }

                fluidGrid(gridItems);
            }

            function getGridItemHtml(gridItem) {
                return  '<div class="gridItemContainer">' +
                        '    <div class="gridItem paper">' +
                        '        <div class="gridItem_graph" style="background-image:url(\'' + gridItem['graphUrl'] + '\')"></div>' +
                        '        <div class="gridItemInfos">' +
                        '            <div class="gridItem_pluginName">' + gridItem['pluginName'] + '</div>' +
                        '            <div class="gridItem_serverName">' + gridItem['serverName'] + '</div>' +
                        '       </div>' +
                        '   </div>' +
                        '</div>';
            }

            function getMaxRows(gridItems) {
                var maxRow = 0;
                for (var i=0; i<gridItems.length; i++) {
                    var y = gridItems[i]['y'];
                    if (y > maxRow)
                        maxRow = y;
                }
                return maxRow;
            }

            function getRowItems(gridItems, y) {
                var rowItems = [];
                for (var i=0; i<gridItems.length; i++) {
                    if (gridItems[i]['y'] == y)
                        rowItems[rowItems.length] = gridItems[i];
                }

                return rowItems;
            }

            function getWidestRowItemsCount(gridItems) {
                var widestRow = -1;
                var widestRowCount = -1;

                for (var y=0; y<=getMaxRows(gridItems); y++) {
                    var nbItems = getRowItems(gridItems, y).length;
                    if (nbItems > widestRowCount) {
                        widestRowCount = nbItems;
                        widestRow = y;
                    }
                }

                return widestRowCount;
            }

            function fluidGrid(gridItems) {
                var gridItemsRowList = $('.gridItemsRow');

                // Set gridItemContainers width
                var gridItemMaxWidthCssAttr = $('.gridItemContainer').first().css('max-width');
                var gridItemMaxWidth = gridItemMaxWidthCssAttr.substr(0, 3);
                var widestRowItemsCount = getWidestRowItemsCount(gridItems);
                var width = ($('#gridsContainer').width() - 30) / widestRowItemsCount;
                if (width > gridItemMaxWidth)
                    width = gridItemMaxWidth;
                width = Math.trunc(width);

                gridItemsRowList.children().css('min-width', width);

                // Set gridItem_graphs height
                var ratio = 497/228;
                gridItemsRowList.each(function() {
                    $(this).find('.gridItem_graph').each(function() {
                        var width = $(this).width();
                        var height = width * (1/ratio);
                        height = Math.trunc(height);
                        $(this).css('height', height);
                    });
                });
            }

            function preview(graphUrl, pluginName, serverName) {
                $('.card-pluginName').text(pluginName);
                $('.card-serverName').text(serverName);
                $('#card-graph').attr('src', graphUrl);
                $('#fullscreen').show();
            }

            function log(msg) {
                if (DEBUG)
                    console.log(msg);
            }
        </script>
    </body>
</html>
